# ModSecurity Geo-blocking Rules for Thailand Only
# This rule set blocks all non-Thailand countries
# 
# Installation:
# 1. Copy this file to /etc/modsecurity/rules/ (or custom rules directory)
# 2. Include in Apache config or ModSecurity config
# 3. Restart Apache: sudo systemctl restart apache2

# Enable GeoIP lookups (requires mod_geoip2)
# This must be enabled at Apache level in main config

# Rule 1: Log all requests with country code
SecRule GEO:COUNTRY_CODE "@rx ^.*$" \
    "id:1001,\
    phase:1,\
    pass,\
    nolog,\
    setvar:country=%{GEO:COUNTRY_CODE}"

# Rule 2: Block all non-Thailand countries
# Exceptions: localhost, private IPs
SecRule GEO:COUNTRY_CODE "!^(TH|)$" \
    "id:1002,\
    phase:1,\
    deny,\
    status:403,\
    msg:'Access denied - Country blocked',\
    log,\
    logdata:'Country: %{GEO:COUNTRY_CODE}'",\
    "skipAfter:END_GEO_RULES"

# Exception: Allow private/local IP ranges
SecRule REMOTE_ADDR "@ipMatch 127.0.0.1,::1,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16" \
    "id:1003,\
    phase:1,\
    pass,\
    nolog,\
    skip:1"

# Mark end of geo-blocking rules
SecMarker END_GEO_RULES

# Optional: Custom response for blocked access
SecRule id "@eq 1002" \
    "id:1004,\
    phase:1,\
    pass,\
    msg:'Geo-blocking applied',\
    log"
